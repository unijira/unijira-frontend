<ion-content>
  <div class="page">
    <ion-row>
      <ion-col>
        <h1 (click)="editPesoPopover($event)">Sprint</h1>
        <div class="sprint">
          <div *ngIf="!sprint || !sprint.tasks">
            <p>Sprint vuoto</p>
          </div>
          <div *ngIf="sprint && sprint.tasks">
            <ion-list
              dragula="bag"
              [(dragulaModel)]="sprint.tasks"
              lines="none"
              class="light-gray-bg"
            >
              <ion-row
                *ngFor="let task of sprint.tasks"
                class="ion-align-items-end task-item white-bg"
              >
                <ion-col>
                  <fa-icon
                    [icon]="['fas', 'bookmark']"
                    class="taskicon"
                  ></fa-icon>
                  <span class="task-name"> {{ task.name }} </span>
                </ion-col>

                <ion-col class="ion-justify-content-end" class="icon-area">
                  <div *ngIf="task.children?.length > 0">
                    <fa-icon
                      [icon]="['fas', 'network-wired']"
                      class="childicon"
                    >
                    </fa-icon>
                  </div>

                  <div (click)="editPesoPopover($event, task.weight)">
                    <ion-badge
                      class="weight-badge"
                      color="light"
                      (save)="editWeight($event, task, 'backlog')"
                    >
                      <span>{{ task.weight }}</span>
                    </ion-badge>
                  </div>

                  <div (click)="editStatusPopover($event, task.status)">
                    <ion-badge
                      *ngIf="task.status === 'da_completare' "
                      color="medium"
                      >{{ task.status.replace("_", " ") }}</ion-badge
                    >
                    <ion-badge
                      *ngIf="task.status === 'completato' "
                      color="success"
                      >{{ task.status.replace("_", " ") }}</ion-badge
                    >
                    <ion-badge
                      *ngIf="task.status === 'in_corso' "
                      color="primary"
                      >{{ task.status.replace("_", " ") }}</ion-badge
                    >
                  </div>

                  <ion-thumbnail class="avatar" *ngIf="task.assignedTo">
                    <img class="avatar-img" [src]="task.assignedTo[0].avatar" />
                  </ion-thumbnail>
                  <ion-button
                    size="small"
                    color="light"
                    (click)="presentModal(task)"
                  >
                    <fa-icon
                      [icon]="['fas', 'ellipsis-h']"
                      class="childicon"
                    ></fa-icon>
                  </ion-button>
                </ion-col>
              </ion-row>
            </ion-list>
          </div>
        </div>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col>
        <h1>Backlog</h1>
        <div class="backlog">
          <div *ngIf="!backlog || !backlog.tasks">
            <p>Backlog vuoto</p>
          </div>
          <div *ngIf="backlog && backlog.tasks">
            <ion-list
              dragula="bag"
              lines="none"
              class="light-gray-bg"
              [(dragulaModel)]="backlog.tasks"
            >
              <ion-row
                *ngFor="let task of backlog.tasks"
                class="task-item ion-align-items-end white-bg"
              >
                <ion-col (click)="presentModal(task)">
                  <fa-icon
                    [icon]="['fas', 'bookmark']"
                    class="taskicon"
                  ></fa-icon>
                  {{ task.name }}
                </ion-col>
                <ion-col size="2" class="ion-justify-content-end icon-area">
                  <ion-item class="weitght-field">
                    <ion-input
                      class="no-inline-padding"
                      inputmode="numeric"
                      type="numeric"
                      (ionInput)="editWeight($event, task, 'backlog')"
                      placeholder="{{task.weight}}"
                    ></ion-input>
                  </ion-item>
                  <ion-item class="status-item">
                    <ion-label class="success">{{task.status}}</ion-label>
                    <ion-select
                      (ionChange)="editStatus($event, task, 'backlog')"
                      class="status-select"
                    >
                      <ion-select-option value="da_completare"
                        >Da Completare</ion-select-option
                      >
                      <ion-select-option value="completata"
                        >Completata</ion-select-option
                      >
                      <ion-select-option value="in_corso"
                        >In Corso</ion-select-option
                      >
                    </ion-select>
                  </ion-item>

                  <ion-icon
                    *ngIf="task.children?.length > 0"
                    name="git-branch"
                  ></ion-icon>
                  <ion-thumbnail class="avatar" *ngIf="task.assignedTo">
                    <img class="avatar-img" [src]="task.assignedTo[0].avatar" />
                  </ion-thumbnail>
                  <ion-icon class="edit-icon" name="create"></ion-icon>
                </ion-col>
              </ion-row>
            </ion-list>
          </div>
        </div>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col>
        <ion-button
          (click)="getFromApi()"
          expand="block"
          color="primary"
          class="add-task-button"
        >
          Get from server
        </ion-button>
      </ion-col>
      <ion-col>
        <ion-button
          (click)="saveToAPI()"
          expand="block"
          color="primary"
          class="add-task-button"
        >
          Save on server
        </ion-button>
      </ion-col>
    </ion-row>
  </div>
</ion-content>
